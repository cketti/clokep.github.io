<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Like bricks in the sky - SIPE</title>
        <link rel="stylesheet" href="http://patrick.cloke.us/theme/css/main.css" />
        <link href="http://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Like bricks in the sky Atom Feed" />
        <link href="http://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Like bricks in the sky RSS Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://patrick.cloke.us/">Like bricks in the sky </a></h1>
                <nav><ul>
                    <li><a href="http://patrick.cloke.us/pages/about.html">About</a></li>
                    <li><a href="http://patrick.cloke.us/pages/contact.html">Contact</a></li>
                    <li><a href="http://patrick.cloke.us/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->

        <div id="container" class="body">
        <section id="extras">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="http://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://www.twitter.com/clokep">twitter</a></li>
                            <li><a href="https://bitbucket.org/clokep">bitbucket</a></li>
                            <li><a href="https://www.github.com/clokep">github</a></li>
                            <li><a href="https://mozillians.org/clokep">mozillians</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->


            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://patrick.cloke.us/posts/2011/Sep/03/adding-a-protocol-to-instantbird-part-2/">Adding a protocol to Instantbird (Part&nbsp;2)</a></h1>
<footer class="post-info">
        <abbr class="published" title="2011-09-03T14:31:00">
                Published: 09/03/2011 02:31 PM UTC
        </abbr>

<p>In <a href="http://patrick.cloke.us/category/misc.html">misc</a>. </p>
<p>tags: <a href="http://patrick.cloke.us/tag/instantbird.html">Instantbird</a> <a href="http://patrick.cloke.us/tag/programming.html">programming</a> <a href="http://patrick.cloke.us/tag/sipe.html">SIPE</a> </p>
</footer><!-- /.post-info --><p>I had <a class="reference external" href="http://patrick.cloke.us/posts/2011/Jun/19/adding-a-new-protocol-sipeoffice-communicator-to-instantbird-part-1/">previously talked about adding a protocol to Instantbird</a>,
that focused on adding <span class="caps">SIPE</span> (Microsoft Office Communicator support).
Since then I&#8217;ve been slowly working on defeating <span class="caps">SIPE</span>.&nbsp; Fortunately I
found a few flags that help us compile it easily in Instantbird: we can
declare that we do <em>not</em> have gmime and the standard libpurple <span class="caps">MIME</span>
functions will be used (they might not be as good, but it keeps from
adding &gt;10 <span class="caps">MB</span> of source to&nbsp;Instantbird).</p>
<p>Some modifications to the <span class="caps">SIPE</span> source were made to compile it in
Instantbird (note that most of the changes were probably more based on
using <span class="caps">MSVC</span>, than having to do with Instantbird).&nbsp; The code is also
broken up into a few different sections the core, api, and purple are
ones we care about (they&#8217;re working on making a general Office
Communicator protocol library, so the purple folder contains the
libpurple bindings that use the api, while the core is&nbsp;private).</p>
<div class="section" id="purple">
<h2>Purple</h2>
<p>Changes to purple consisted mostly of ifdefs that remove some header
files not supported on Windows.&nbsp; For example, I encountered a few&nbsp;of:</p>
<pre class="literal-block">
#include &lt;unistd.h&gt;
</pre>
<p>Luckily there was already a define <tt class="docutils literal">HAVE_UNISTD_H</tt>, so I just needed
to&nbsp;add:</p>
<pre class="literal-block">
#ifdef HAVE_UNISTD_H
#include &lt;unistd.h&gt;
#endif
</pre>
<p>Easy!&nbsp; There were also a couple other issues, but those were rather&nbsp;trivial.</p>
</div>
<div class="section" id="core">
<h2>Core</h2>
<p>There isn&#8217;t a specific issue in the core I&#8217;d like to highlight, it did
use a few glib functions which we didn&#8217;t have (we removed the files, as
they were unused), they were all reimplemented in libpurple though, so
we were able to just define the function calls to the libpurple&nbsp;variants.</p>
</div>
<div class="section" id="api">
<h2><span class="caps">API</span></h2>
<p>This had similar issues the core (in particular, there was a function
which used <tt class="docutils literal">g_usleep</tt>, which is blocking and a definite no-no for a
protocol plug-in, I&#8217;ve removed that&#8230;hopefully it doesn&#8217;t break
anything!)&nbsp; In addition to that, we needed to use the libpurple l10n
system instead of glib&#8217;s gi18n.h, this was easily copied from
libpurple&#8217;s internal <span class="caps">API</span>&nbsp;though.</p>
<p>So at this point&#8230;I have a copy of <span class="caps">SIPE</span> compiled!&nbsp; Unfortunately
since I&#8217;m using Visual Studio Express I cannot compile on my computer
and deploy to other computers for testing (a Mozilla issue with how it
uses some of the header files, etc., I believe).&nbsp; I&#8217;m looking into
trying to get this to work though, apparently using the exact same copy
of <span class="caps">MSVC</span> Redistributable might help.&nbsp; Once this is tested, hopefully
it&#8217;ll land in Instantbird for&nbsp;use!</p>
</div>
<div class="section" id="sametime-support">
<h2>Sametime&nbsp;support</h2>
<p>Unrelated to <span class="caps">SIPE</span>, but recently I landed a patch in Instantbird to add
back Sametime support (Sametime is Lotus Notes&#8217; equivalent to Office
Communicator).&nbsp; You can see the gory details in <a class="reference external" href="https://bugzilla.instantbird.org/show_bug.cgi?id=102">bug 102</a>, but in
general it&#8217;s similar to what I&#8217;ve (not gone into great detail about)
here. Most of getting Sametime to work was rewriting some C code
that doesn&#8217;t compile in <span class="caps">MSVC</span>.&nbsp; There&#8217;s also a <a class="reference external" href="https://bugzilla.instantbird.org/attachment.cgi?id=797&amp;action=diff">diff</a> of all the
changes I made to the libpurple Sametime plugin and the external library
(called <a class="reference external" href="http://meanwhile.sourceforge.net/">Meanwhile</a>) to get it to work.&nbsp; Once I get Monotone (a version
control system) set up I&#8217;ll look into getting these changes pushed back
to libpurple to avoid diverging code&nbsp;bases.</p>
</div>
                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://patrick.cloke.us/posts/2011/Jun/19/adding-a-new-protocol-sipeoffice-communicator-to-instantbird-part-1/" rel="bookmark"
                           title="Permalink to Adding a new protocol (SIPE/Office Communicator) to Instantbird (partÂ 1)">Adding a new protocol (<span class="caps">SIPE</span>/Office Communicator) to Instantbird (part&nbsp;1)</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2011-06-19T01:53:00">
                Published: 06/19/2011 01:53 AM UTC
        </abbr>

<p>In <a href="http://patrick.cloke.us/category/misc.html">misc</a>. </p>
<p>tags: <a href="http://patrick.cloke.us/tag/instantbird.html">Instantbird</a> <a href="http://patrick.cloke.us/tag/programming.html">programming</a> <a href="http://patrick.cloke.us/tag/sipe.html">SIPE</a> </p>
</footer><!-- /.post-info -->                <p><a class="reference external" href="http://en.wikipedia.org/wiki/Office_Communicator">Microsoft Office Communicator</a> is an instant messaging client that
integrates into the <a class="reference external" href="http://en.wikipedia.org/wiki/Microsoft_Exchange_Server">Exchange Messaging Server</a> (the protocol behind it
is an extended version of <span class="caps">SIP</span>/<span class="caps">SIMPLE</span>).&nbsp; Anyway, there&#8217;s a <a class="reference external" href="http://developer.pidgin.im/wiki/WhatIsLibpurple">libpurple</a>
(i.e. the backend of <a class="reference external" href="http://instantbird.com/">Instantbird</a> and <a class="reference external" href="http://pidgin.im/">Pidgin</a>) protocol plug-in for
<span class="caps">OCS</span> (Office Communicator Server) called <a class="reference external" href="http://sipe.sourceforge.net/"><span class="caps">SIPE</span></a>.&nbsp; (It&#8217;s ...</p>
                <a class="readmore" href="http://patrick.cloke.us/posts/2011/Jun/19/adding-a-new-protocol-sipeoffice-communicator-to-instantbird-part-1/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
                </section><!-- /#content -->


        </div>

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52389517-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>