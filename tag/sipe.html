<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Like bricks in the sky - SIPE</title>

    <link rel="stylesheet" href="http://patrick.cloke.us/theme/css/main.css?10ddb23c" />
    <link href="http://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Like bricks in the sky Atom Feed" />
    <link href="http://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Like bricks in the sky RSS Feed" />

    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body id="index" class="home">
    <header id="banner" class="body">
        <h1><a href="http://patrick.cloke.us/">Like bricks in the sky </a></h1>
        <nav><ul>
            <li><a href="http://patrick.cloke.us/pages/about.html">About</a></li>
            <li><a href="http://patrick.cloke.us/pages/contact.html">Contact</a></li>
            <li><a href="http://patrick.cloke.us/pages/resources.html">Resources</a></li>
            <li><a href="http://patrick.cloke.us/archives.html">Archives</a></li>
            <li><a href="http://patrick.cloke.us/tags.html">Tags</a></li>
        </ul></nav>
    </header><!-- /#banner -->

    <div id="container" class="body">
        <section id="extras" class="left">
            <div class="social">
                <h2>social</h2>
                <ul>
                    <li><a href="https://www.twitter.com/clokep" target="_blank">twitter</a></li>
                    <li><a href="https://bitbucket.org/clokep" target="_blank">bitbucket</a></li>
                    <li><a href="https://www.github.com/clokep" target="_blank">github</a></li>
                    <li><a href="https://mozillians.org/u/clokep/" target="_blank">mozillians</a></li>

                    <li><a href="http://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                    <li><a href="http://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>
                </ul>
            </div><!-- /.social -->
        </section><!-- /#extras -->

        <section id="search" class="left">
            <h2>search</h2>

            <form method="get" action="http://www.google.com/search" target="_blank">

                <input type="text" name="q" placeholder="search this site" />
                <input type="submit" value="Search" />
                <input type="hidden"  name="sitesearch" value="patrick.cloke.us" />
            </form>
        </section>


        <section id="toc" class="left">
            <h2>table of contents</h2>
            <div class="toc" id="">

<ul class="simple">
<li><a class="reference internal" href="#purple" id="id1">Purple</a></li>
<li><a class="reference internal" href="#core" id="id2">Core</a></li>
<li><a class="reference internal" href="#api" id="id3"><span class="caps">API</span></a></li>
<li><a class="reference internal" href="#sametime-support" id="id4">Sametime support</a></li>
</ul>
</div>
        </section>

        <aside id="featured" class="body">
        <article>
            <h1 class="entry-title"><a href="http://patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/">Adding a protocol to Instantbird (Part&nbsp;2)</a></h1>
<footer class="post-info-container">
    <div class="post-info-top">
    </div>

    <!-- Second div is to change the background color again. -->
    <div class="post-info-bg">
    <div class="post-info">
        <div id="gravatar" style="background-image: url('https://www.gravatar.com/avatar/130405f65521b6ee6bbbe0204070a163');">
        </div>

        <abbr class="published" title="2011-09-03T10:31:00-04:00">
            Published: 09/03/2011 10:31 AM EDT
        </abbr>

        <address class="vcard author">
            By                 <a class="url fn" href="http://patrick.cloke.us/pages/about.html">Patrick Cloke</a>
        </address>


        <div id="gravatar-clear"></div>

        <div id="tag-list">
            tags:                 <a href="http://patrick.cloke.us/tag/instantbird.html">Instantbird</a>
                <a href="http://patrick.cloke.us/tag/programming.html">programming</a>
                <a href="http://patrick.cloke.us/tag/sipe.html">SIPE</a>
        </div>

        

        <div id="post-share-links" class="social">
            share:
            <a href="http://twitter.com/home?status=Adding%20a%20protocol%20to%20Instantbird%20%28Part%C2%A02%29%20http%3A//patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/" target="_blank" title="Share on Twitter">Twitter</a>
            <a href="http://www.facebook.com/sharer/sharer.php?u=http%3A//patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/" target="_blank" title="Share on Facebook">Facebook</a>
            <a href="https://plus.google.com/share?url=http%3A//patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/" target="_blank" title="Share on Google Plus">Google+</a>
            <a href="mailto:?subject=Adding%20a%20protocol%20to%20Instantbird%20%28Part%C2%A02%29&amp;body=http%3A//patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/" target="_blank" title="Share via Email">Email</a>
        </div>
    </div>
    </div>

    <div class="post-info-bottom">
    </div>
</footer><!-- /.post-info -->
<p>I had <a class="reference external" href="http://patrick.cloke.us/posts/2011/06/18/adding-new-protocol-sipeoffice/">previously talked about adding a protocol to Instantbird</a>,
that focused on adding <span class="caps">SIPE</span> (Microsoft Office Communicator support).
Since then I’ve been slowly working on defeating <span class="caps">SIPE</span>.  Fortunately I
found a few flags that help us compile it easily in Instantbird: we can
declare that we do <em>not</em> have gmime and the standard libpurple <span class="caps">MIME</span>
functions will be used (they might not be as good, but it keeps from
adding &gt;10 <span class="caps">MB</span> of source to Instantbird).</p>
<p>Some modifications to the <span class="caps">SIPE</span> source were made to compile it in
Instantbird (note that most of the changes were probably more based on
using <span class="caps">MSVC</span>, than having to do with Instantbird).  The code is also
broken up into a few different sections the core, api, and purple are
ones we care about (they’re working on making a general Office
Communicator protocol library, so the purple folder contains the
libpurple bindings that use the api, while the core is private).</p>
<div class="section" id="purple">
<h2><a class="toc-backref" href="#id1">Purple</a></h2>
<p>Changes to purple consisted mostly of ifdefs that remove some header
files not supported on Windows.  For example, I encountered a few of:</p>
<pre class="literal-block">
#include &lt;unistd.h&gt;
</pre>
<p>Luckily there was already a define <tt class="docutils literal">HAVE_UNISTD_H</tt>, so I just needed
to add:</p>
<pre class="literal-block">
#ifdef HAVE_UNISTD_H
#include &lt;unistd.h&gt;
#endif
</pre>
<p>Easy!  There were also a couple other issues, but those were rather trivial.</p>
</div>
<div class="section" id="core">
<h2><a class="toc-backref" href="#id2">Core</a></h2>
<p>There isn’t a specific issue in the core I’d like to highlight, it did
use a few glib functions which we didn’t have (we removed the files, as
they were unused), they were all reimplemented in libpurple though, so
we were able to just define the function calls to the libpurple variants.</p>
</div>
<div class="section" id="api">
<h2><a class="toc-backref" href="#id3"><span class="caps">API</span></a></h2>
<p>This had similar issues the core (in particular, there was a function
which used <tt class="docutils literal">g_usleep</tt>, which is blocking and a definite no-no for a
protocol plug-in, I’ve removed that…hopefully it doesn’t break
anything!)  In addition to that, we needed to use the libpurple l10n
system instead of glib’s gi18n.h, this was easily copied from
libpurple’s internal <span class="caps">API</span> though.</p>
<p>So at this point…I have a copy of <span class="caps">SIPE</span> compiled!  Unfortunately
since I’m using Visual Studio Express I cannot compile on my computer
and deploy to other computers for testing (a Mozilla issue with how it
uses some of the header files, etc., I believe).  I’m looking into
trying to get this to work though, apparently using the exact same copy
of <span class="caps">MSVC</span> Redistributable might help.  Once this is tested, hopefully
it’ll land in Instantbird for use!</p>
</div>
<div class="section" id="sametime-support">
<h2><a class="toc-backref" href="#id4">Sametime support</a></h2>
<p>Unrelated to <span class="caps">SIPE</span>, but recently I landed a patch in Instantbird to add
back Sametime support (Sametime is Lotus Notes’ equivalent to Office
Communicator).  You can see the gory details in <a class="reference external" href="https://bugzilla.instantbird.org/show_bug.cgi?id=102">bug 102</a>, but in
general it’s similar to what I’ve (not gone into great detail about)
here. Most of getting Sametime to work was rewriting some C code
that doesn’t compile in <span class="caps">MSVC</span>.  There’s also a <a class="reference external" href="https://bugzilla.instantbird.org/attachment.cgi?id=797&amp;action=diff">diff</a> of all the
changes I made to the libpurple Sametime plugin and the external library
(called <a class="reference external" href="http://meanwhile.sourceforge.net/">Meanwhile</a>) to get it to work.  Once I get Monotone (a version
control system) set up I’ll look into getting these changes pushed back
to libpurple to avoid diverging code bases.</p>
</div>
<p><a href="http://patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/#disqus_thread">comments</a></p>        </article>
        </aside><!-- /#featured -->
        <section id="content" class="body">
            <h1>Other articles</h1>
            <hr />
            <ol id="posts-list" class="hfeed">

        <li><article class="hentry">
        <header>
            <h1><a href="http://patrick.cloke.us/posts/2011/06/18/adding-new-protocol-sipeoffice/" rel="bookmark"
               title="Permalink to Adding a new protocol (SIPE/Office Communicator) to Instantbird (part 1)">Adding a new protocol (<span class="caps">SIPE</span>/Office Communicator) to Instantbird (part&nbsp;1)</a></h1>
        </header>

        <div class="entry-content">
<footer class="post-info">
    <abbr class="published" title="2011-06-18T21:53:00-04:00">
        Published: 06/18/2011 09:53 PM EDT
    </abbr>

    <address class="vcard author">
        By             <a class="url fn" href="http://patrick.cloke.us/pages/about.html">Patrick Cloke</a>
    </address>


    <p>
        tags:             <a href="http://patrick.cloke.us/tag/instantbird.html">Instantbird</a>
            <a href="http://patrick.cloke.us/tag/programming.html">programming</a>
            <a href="http://patrick.cloke.us/tag/sipe.html">SIPE</a>
    </p>

    
</footer><!-- /.post-info -->        <p><a class="reference external" href="http://en.wikipedia.org/wiki/Office_Communicator">Microsoft Office Communicator</a> is an instant messaging client that
integrates into the <a class="reference external" href="http://en.wikipedia.org/wiki/Microsoft_Exchange_Server">Exchange Messaging Server</a> (the protocol behind it
is an extended version of <span class="caps">SIP</span>/<span class="caps">SIMPLE</span>).&nbsp; Anyway, there&#8217;s a <a class="reference external" href="http://developer.pidgin.im/wiki/WhatIsLibpurple">libpurple</a>
(i.e. the backend of <a class="reference external" href="http://instantbird.com/">Instantbird</a> and <a class="reference external" href="http://pidgin.im/">Pidgin</a>) protocol plug-in for
<span class="caps">OCS</span> (Office Communicator Server) called <a class="reference external" href="http://sipe.sourceforge.net/"><span class="caps">SIPE</span></a>.&nbsp; (It&#8217;s …</p>
        <a class="readmore" href="http://patrick.cloke.us/posts/2011/06/18/adding-new-protocol-sipeoffice/">read more &rarr;</a>
<p><a href="http://patrick.cloke.us/posts/2011/06/18/adding-new-protocol-sipeoffice/#disqus_thread">comments</a></p>        </div><!-- /.entry-content -->
        </article></li>
        </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
        </section><!-- /#content -->
    </div>

    <footer id="contentinfo" class="body">
        <address id="about" class="vcard body">
        Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
        Blog source available on <a href="https://github.com/clokep/clokep.github.io">GitHub</a>.
        </address><!-- /#about -->
    </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52389517-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'clokep';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>