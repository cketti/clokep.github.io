<!DOCTYPE html>
<html lang="en">
<head>

        <title>Adding a protocol to Instantbird (Part 2)</title>
        <meta charset="utf-8" />
        <link href="http://patrick.cloke.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Like bricks in the sky Full Atom Feed" />
        <link href="http://patrick.cloke.us/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Like bricks in the sky Full RSS Feed" />
        <link href="http://patrick.cloke.us/feeds/mozilla.atom.xml" type="application/atom+xml" rel="alternate" title="Like bricks in the sky Categories Atom Feed" />
        <link href="http://patrick.cloke.us/feeds/mozilla.rss.xml" type="application/rss+xml" rel="alternate" title="Like bricks in the sky Categories RSS Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="http://patrick.cloke.us/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="http://patrick.cloke.us/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="http://patrick.cloke.us/theme/pygment.css" />

        <script src="http://patrick.cloke.us/theme/js/libs/modernizr-2.6.2.min.js"></script>






</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="http://patrick.cloke.us">Like bricks in the sky <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="http://patrick.cloke.us">Home</a></li>

                <li><a href="http://patrick.cloke.us/pages/about.html">About</a></li>
                <li><a href="http://patrick.cloke.us/pages/contact.html">Contact</a></li>

                <li><a href="http://patrick.cloke.us/archives.html">Archives</a></li>
                <li><a href="http://patrick.cloke.us/tags.html">Tags</a></li>
              </ul>
            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="http://patrick.cloke.us/adding-a-protocol-to-instantbird-part-2.html" rel="bookmark"
                   title="Permalink to Adding a protocol to Instantbird (Part 2)">Adding a protocol to Instantbird (Part 2)</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="2011-09-03T14:31:00">
                09/03/2011 02:31 PM UTC
              </abbr>
              <address class="vcard author">
                By <a class="url fn" href="http://patrick.cloke.us/author/patrick-cloke.html">Patrick Cloke</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>I had <a class="reference external" href="http://patrick.cloke.us/adding-a-new-protocol-sipeoffice-communicator-to-instantbird-part-1.html">previously talked about adding a protocol to Instantbird</a>,
that focused on adding SIPE (Microsoft Office Communicator support).
Since then I've been slowly working on defeating SIPE.&nbsp; Fortunately I
found a few flags that help us compile it easily in Instantbird: we can
declare that we do <em>not</em> have gmime and the standard libpurple MIME
functions will be used (they might not be as good, but it keeps from
adding &gt;10 MB of source to Instantbird).</p>
<p>Some modifications to the SIPE source were made to compile it in
Instantbird (note that most of the changes were probably more based on
using MSVC, than having to do with Instantbird).&nbsp; The code is also
broken up into a few different sections the core, api, and purple are
ones we care about (they're working on making a general Office
Communicator protocol library, so the purple folder contains the
libpurple bindings that use the api, while the core is private).</p>
<div class="section" id="purple">
<h2>Purple</h2>
<p>Changes to purple consisted mostly of ifdefs that remove some header
files not supported on Windows.&nbsp; For example, I encountered a few of:</p>
<pre class="literal-block">
#include &lt;unistd.h&gt;
</pre>
<p>Luckily there was already a define <tt class="docutils literal">HAVE_UNISTD_H</tt>, so I just needed
to add:</p>
<pre class="literal-block">
#ifdef HAVE_UNISTD_H
#include &lt;unistd.h&gt;
#endif
</pre>
<p>Easy!&nbsp; There were also a couple other issues, but those were rather
trivial.</p>
</div>
<div class="section" id="core">
<h2>Core</h2>
<p>There isn't a specific issue in the core I'd like to highlight, it did
use a few glib functions which we didn't have (we removed the files, as
they were unused), they were all reimplemented in libpurple though, so
we were able to just define the function calls to the libpurple
variants.</p>
</div>
<div class="section" id="api">
<h2>API</h2>
<p>This had similar issues the core (in particular, there was a function
which used <tt class="docutils literal">g_usleep</tt>, which is blocking and a definite no-no for a
protocol plug-in, I've removed that...hopefully it doesn't break
anything!)&nbsp; In addition to that, we needed to use the libpurple l10n
system instead of glib's gi18n.h, this was easily copied from
libpurple's internal API though.</p>
<p>So at this point...I have a copy of SIPE compiled!&nbsp; Unfortunately
since I'm using Visual Studio Express I cannot compile on my computer
and deploy to other computers for testing (a Mozilla issue with how it
uses some of the header files, etc., I believe).&nbsp; I'm looking into
trying to get this to work though, apparently using the exact same copy
of MSVC Redistributable might help.&nbsp; Once this is tested, hopefully
it'll land in Instantbird for use!</p>
</div>
<div class="section" id="sametime-support">
<h2>Sametime support</h2>
<p>Unrelated to SIPE, but recently I landed a patch in Instantbird to add
back Sametime support (Sametime is Lotus Notes' equivalent to Office
Communicator).&nbsp; You can see the gory details in <a class="reference external" href="https://bugzilla.instantbird.org/show_bug.cgi?id=102">bug 102</a>, but in
general it's similar to what I've (not gone into great detail about)
here. Most of getting Sametime to work was rewriting some C code
that doesn't compile in MSVC.&nbsp; There's also a <a class="reference external" href="https://bugzilla.instantbird.org/attachment.cgi?id=797&amp;action=diff">diff</a> of all the
changes I made to the libpurple Sametime plugin and the external library
(called <a class="reference external" href="http://meanwhile.sourceforge.net/">Meanwhile</a>) to get it to work.&nbsp; Once I get Monotone (a version
control system) set up I'll look into getting these changes pushed back
to libpurple to avoid diverging code bases.</p>
</div>

            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->
        
<div class="three columns">

<h4>Pages</h4>

 <ul>
      <li><a href="http://patrick.cloke.us/pages/about.html">About</a></li>
      <li><a href="http://patrick.cloke.us/pages/contact.html">Contact</a></li>
  </ul>

<h4>Categories</h4>
<ul>
		<li><a href="http://patrick.cloke.us/category/mozilla.html">Mozilla</a></li>
</ul>


<h4><i class="icon-tag"></i>Tags</h4>
	<ul>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/email.html">email</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/irc.html">IRC</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/programming.html">programming</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/messaging.html">messaging</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/google.html">Google</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/mozilla.html">Mozilla</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/customizing.html">customizing</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/smtp.html">SMTP</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/bugs.html">bugs</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/sipe.html">SIPE</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/pop3.html">POP3</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/status.html">status</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/im.html">IM</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/instantbird.html">Instantbird</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/thunderbird.html">Thunderbird</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/chat.html">chat</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/rss.html">RSS</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/lightning.html">Lightning</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/specifications.html">specifications</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/imap.html">IMAP</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/gsoc.html">GSoC</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/crosspost.html">crosspost</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/wat.html">Wat</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/oscar.html">OSCAR</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/instant-messaging.html">instant messaging</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/yahoo.html">Yahoo</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/community.html">community</a></li>
</ul>



<h4><i class="icon-rss"></i>Subscribe</h4>
<ul>
  <li><a href="http://patrick.cloke.us/feeds/all.atom.xml">Full Atom Feed</a></li>
  <li><a href="http://patrick.cloke.us/feeds/all.rss.xml">Full RSS Feed</a></li>
</ul>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">

                <li><div class="btn primary"><a href="https://www.github.com/clokep" target="_blank">Github</a></div></li>

                <li><div class="btn bitbucket"><a href="https://bitbucket.org/clokep" target="_blank">BitBucket</a></div></li>

                <li><div class="btn mozillians"><a href="https://mozillians.org/clokep" target="_blank">Mozillians</a></div></li>

                <li><div class="btn twitter"><a href="https://www.twitter.com/clokep" target="_blank">Twitter</a></div></li>



              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="http://patrick.cloke.us/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="http://patrick.cloke.us/theme/js/libs/gumby.min.js"></script>
  <script src="http://patrick.cloke.us/theme/js/plugins.js"></script>
</body>
</html>