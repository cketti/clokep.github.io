<!DOCTYPE html>
<html lang="en">
<head>

        <title>Why Rewrite IRC into JavaScript? (vs. libpurple's vs. ChatZilla's)</title>
        <meta charset="utf-8" />
        <link href="http://patrick.cloke.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Like bricks in the sky Full Atom Feed" />
        <link href="http://patrick.cloke.us/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Like bricks in the sky Full RSS Feed" />
        <link href="http://patrick.cloke.us/feeds/mozilla.atom.xml" type="application/atom+xml" rel="alternate" title="Like bricks in the sky Categories Atom Feed" />
        <link href="http://patrick.cloke.us/feeds/mozilla.rss.xml" type="application/rss+xml" rel="alternate" title="Like bricks in the sky Categories RSS Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="http://patrick.cloke.us/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="http://patrick.cloke.us/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="http://patrick.cloke.us/theme/pygment.css" />

        <script src="http://patrick.cloke.us/theme/js/libs/modernizr-2.6.2.min.js"></script>






</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="http://patrick.cloke.us">Like bricks in the sky <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="http://patrick.cloke.us">Home</a></li>

                <li><a href="http://patrick.cloke.us/pages/about.html">About</a></li>
                <li><a href="http://patrick.cloke.us/pages/contact.html">Contact</a></li>

                <li><a href="http://patrick.cloke.us/archives.html">Archives</a></li>
                <li><a href="http://patrick.cloke.us/tags.html">Tags</a></li>
              </ul>
            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="http://patrick.cloke.us/why-rewrite-irc-into-javascript-vs-libpurples-vs-chatzillas.html" rel="bookmark"
                   title="Permalink to Why Rewrite IRC into JavaScript? (vs. libpurple's vs. ChatZilla's)">Why Rewrite IRC into JavaScript? (vs. libpurple's vs. ChatZilla's)</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="2010-12-08T18:29:00">
                12/08/2010 06:29 PM UTC
              </abbr>
              <address class="vcard author">
                By <a class="url fn" href="http://patrick.cloke.us/author/patrick-cloke.html">Patrick Cloke</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>I had a request on IRC (from Mic) to write an in-depth blog post
about <a class="reference external" href="https://bugzilla.instantbird.org/show_bug.cgi?id=507">IRC in JavaScript</a>:</p>
<blockquote>
&quot;Maybe we could ask clokep if he'd like to write something about
js-irc? Why it is done, what the advantages are once it's done, how
he is working on it (going through the specs), putting the
jsProtocol code to test and adding missing pieces?&quot; -- <a class="reference external" href="http://log.bezut.info/instantbird/101208/#m54">Mic</a></blockquote>
<div class="section" id="wait-a-second-what-is-irc">
<h2>Wait a second, what is IRC?</h2>
<p>I guess this is a good first question, I'll steal from <a class="reference external" href="http://en.wikipedia.org/wiki/IRC">Wikipedia</a>:</p>
<blockquote>
Internet Relay Chat (IRC) is a form of real-time [...] chat [...] It
is mainly designed for group communication [...] but also allows
[...for...] private message as well as chat and data transfers.</blockquote>
<p>Awesome, what's that really mean?&nbsp; It's an instant messaging protocol
with an actual specification (i.e. it's not owned by some large, unnamed
company), with open-source libraries for clients and servers.&nbsp; It's
usually used by more computer-oriented types of people and centers
around group conversation.&nbsp; Personally most of what I use it for is
open-source software I use (I'm almost always in <a class="reference external" href="irc://irc.mozilla.org/#instantbird">#instantbird</a>,
<a class="reference external" href="irc://irc.mozilla.org/#maildev">#maildev</a>, and <a class="reference external" href="irc://irc.mozilla.org/#songbird">#songbird</a> on <a class="reference external" href="http://irc.mozilla.org/">Mozilla's IRC servers</a>.)</p>
</div>
<div class="section" id="why-it-is-done-what-advantages-are-there-once-this-is-done">
<h2>Why it is done?&nbsp; What advantages are there once this is done?</h2>
<p>I touched upon this a little in my <a class="reference external" href="http://patrick.cloke.us/javascript-irc-in-instantbird.html">last post</a>.&nbsp; In terms of
Instantbird: there's an idea of switching some / all of the protocols
(eventually) to be JavaScript protocols instead of the libpurple
versions (libpurple is written mostly in C and is cross-platform, but
recent gains in speed in JavaScript allow this advantage of libpurple to
not matter as much).&nbsp; This would unfortunately mean we need to maintain
a lot more code, but it would allow us to integrate protocols in any way
that we see fit, instead of only using APIs / methods provided by
libpurple.&nbsp; Hopefully this would allow us to <a class="reference external" href="https://bugzilla.instantbird.org/showdependencytree.cgi?id=507&amp;maxdepth=2&amp;hide_resolved=1">enhance our IRC
implementation</a> a bit.</p>
<p>Also, Instantbird (nightlies) currently have limited support for
generating a protocol plug-in in JavaScript.&nbsp; A couple of &quot;test&quot;
protocols have be done, but nothing in &quot;real&quot; (in particular, none that
used a multi-user chat).&nbsp; This would allow us to iron out <a class="reference external" href="https://bugzilla.instantbird.org/show_bug.cgi?id=519">some</a>
<a class="reference external" href="https://bugzilla.instantbird.org/show_bug.cgi?id=118">bugs</a> in the implementation of JavaScript protocols.</p>
<p><em>[Edit: Florian suggested another question that wasn't originally
covered, which some people more familiar with Mozilla code might be
wondering.]</em></p>
</div>
<div class="section" id="why-aren-t-you-using-the-code-from-chatzilla">
<h2>Why aren't you using the code from ChatZilla?</h2>
<p>This was a tough one.&nbsp; Honestly when I first wanted a parsing
algorithm, I looked at the ChatZilla code, I used it.&nbsp; Then rewrote it
in a fourth as many lines (<a class="reference external" href="http://hg.mozilla.org/chatzilla/file/tip/js/lib/irc.js#l1250">93</a> vs. <a class="reference external" href="https://hg.instantbird.org/experiments/file/IRC-JavaScript/components/ircProtocol.js#l208">20</a>).&nbsp; Simply said, the code in
ChatZilla is <em>old</em>, it doesn't use many of the features available only
in newer versions of JavaScript.&nbsp; To that point, the ChatZilla code
hasn't been updated in over a year!&nbsp; The last check-in was: 2009-10-03,
below is a <a class="reference external" href="http://hg.mozilla.org/chatzilla/log/tip/js/lib/irc.js">quick summary</a> of the number of check-ins per year:</p>
<ul class="simple">
<li>2010: 0</li>
<li>2009: 5</li>
<li>2008: 15</li>
<li>2007: 11</li>
<li>2006: 18</li>
</ul>
<p>There's been a pretty steady decline in check-ins.&nbsp; I could take this
code and attempt to whip it into shape and make huge sweeping changes
and commit them back to ChatZilla, but honestly it was easier to start
over for me.&nbsp; Regardless of ease, I'm not sure it would work any:
especially since the ChatZilla code seems overly complicated and overly
specific (since it wasn't really built as a library as far as I can
see), especially since all the code is meant to deal only with IRC.&nbsp; The
Instantbird code needs to be protocol agnostic to a degree, while is why
it interfaces to purplexpcom.</p>
<p>A quick example of this is: ChatZilla uses a CIRCUser object, but for
Instantbird I need to create either an imIContact or a
purpleIAccountBuddy (depending on the situation).&nbsp; It's possible that's
can be abstracted and code shared -- but I'm not sure it would be worth
the effort.&nbsp; After all this, I should probably look more into the
ChatZilla code, perhaps more of it could be used.</p>
<p>(If someone familiar with the ChatZilla code base -- I don't know
who/if there's a maintainer -- is interested in talking with me, please
get in contact here or on #instantbird.&nbsp; It's possible we could align
some of what I've been working on, but I'm not sure how much could be
shared besides the parsing algorithm).</p>
<p><em>[End edit]</em></p>
</div>
<div class="section" id="what-are-the-specific-advantages-for-an-end-user">
<h2>What are the specific advantages for an end-user?</h2>
<p>In terms of the IRC protocol itself, there shouldn't be any, my goal
is for it to be a drop in replacement for the libpurple implementation
with automatic account migration, etc. For end-users we can hopefully
solve <a class="reference external" href="https://bugzilla.instantbird.org/showdependencytree.cgi?id=574&amp;maxdepth=1&amp;hide_resolved=1">a few annoying IRC UI issues</a>.</p>
</div>
<div class="section" id="what-about-for-developers-anything-cool-there">
<h2>What about for developers?&nbsp; Anything cool there?</h2>
<p>Well, I'm hoping to be able to test this replacement via an extension
that replaces the libpurple IRC to dogfood it before eventual inclusion
in Instantbird.&nbsp; I'm not sure if that counts as &quot;cool.&quot; though.&nbsp; If
nothing else there will be an example of how to write a protocol in
JavaScript (using sockets).&nbsp; So hopefully other people can make some
other cool protocols off of that example.&nbsp; You might wonder what else we
have planned for JavaScript protocols; there are plans to make at least
a Twitter protocol.</p>
</div>
<div class="section" id="how-is-this-being-done">
<h2>How is this being done?</h2>
<p>Well I said up above IRC has a specification, right?&nbsp; Well, yes.
There's the <a class="reference external" href="http://tools.ietf.org/html/rfc1459">original specification</a>, this was superseded by <a class="reference external" href="http://tools.ietf.org/html/rfc2810">four</a>
<a class="reference external" href="http://tools.ietf.org/html/rfc2811">different</a> <a class="reference external" href="http://tools.ietf.org/html/rfc2812">specification</a> <a class="reference external" href="http://tools.ietf.org/html/rfc2813">documents</a>.&nbsp; Of which we only really
care about one: <a class="reference external" href="http://tools.ietf.org/html/rfc2812">the client protocol</a>.&nbsp; So we have this updated
specification (try reading it, it's rather painful), which is good.
It's relatively straightforward set of commands and responses/errors.
It's a bit more confusing than that though since there are a couple of
extensions, etc.&nbsp; This is summarized below:</p>
<ul class="simple">
<li>[STRIKEOUT:RFC 1459]<ul>
<li>Extended with <a class="reference external" href="http://www.irchelp.org/irchelp/rfc/dccspec.html">[STRIKEOUT:DCC specification (&quot;direct client-to-client&quot;)]</a><ul>
<li>Replaced with [STRIKEOUT:<a class="reference external" href="http://www.irchelp.org/irchelp/rfc/dccspec.html">CTCP (&quot;client-to-client protocol&quot;)</a>]<ul>
<li><a class="reference external" href="http://www.invlogic.com/irc/ctcp.html">Draft for a formalized CTCP</a></li>
</ul>
</li>
<li>(Apparently some people are working on a <a class="reference external" href="http://www.dcc2.org/">DCC2</a>)</li>
</ul>
</li>
<li>Officially replaced with RFCs 2810, 2811, 2812, 2813</li>
</ul>
</li>
</ul>
<p>A lot of this is being done by reading the specifications and finding
the proper responses, etc.&nbsp; I've also used <a class="reference external" href="http://www.wireshark.org/download.html">Wireshark</a> a bit to see how
libpurple sends IRC commands (in particular, in what order it sends them
in).&nbsp; A lot of my development is happening on live IRC servers, which
isn't really best practice, but I'm mostly sending commands by hand to
see the responses since a bunch of non-standard responses and extensions
have developed beyond the above.&nbsp; I have been using <a class="reference external" href="http://ircd.bircd.org/">beware irc</a> to run
a daemon on my own machine, however.</p>
</div>
<div class="section" id="so-how-far-along-are-you">
<h2>So how far along are you?</h2>
<p>I've started implementing RFC 2812 and have a variety of commands done
(the login sequence occurs automatically, the server connection is kept
alive, messages can be sent to a channel and are parsed when received, a
lot of the initial server information is displayed but unparsed).&nbsp; But
there's a lot more to do!&nbsp; As my last post outlined, I recently was able
to successfully get a chat to work in Instantbird from a silly bug I had
been having.</p>
<p>It's rather slow going since I'll start to implement something from
the IRC side, and then realize the <a class="reference external" href="http://hg.instantbird.org/instantbird/file/tip/purple/purplexpcom/src/jsProtoHelper.jsm">Instantbird layer</a> (the jsProtocol
module) is missing a component I need.&nbsp; One of the major parts of
working on this is extending the Instantbird layer to contain the proper
functions and objects needed to implement chats via JavaScript.&nbsp; This is
usually the slowest going part of my code, since it involves interfacing
with Instantbird / <a class="reference external" href="http://hg.instantbird.org/instantbird/file/tip/purple/purplexpcom/public/">purplexpcom</a>.&nbsp; Luckily Florian, the main developer
of Instantbird, has been a big help with this (as have other
participants of #instantbird -- in particular I know Mic helped track
down a few syntax type bugs).</p>
</div>
<div class="section" id="what-s-next">
<h2>What's next?</h2>
<p>Now that have the basics of chat working, I need to start handling the
QUIT, PART and JOIN commands for when other users enter &amp; leave chat
rooms.&nbsp; Once these are complete it should be quite usable, although the
entire preference system still doesn't exist, including notifying the UI
of what options are available.&nbsp; In addition, I need to look into doing
SSL sockets.</p>
<p>Once the protocol plug-in is done, we plan to abstract sections of it
that will be useful for other protocols (in particular the socket
connection aspects).</p>
</div>
<div class="section" id="where-can-i-see-this-stuff">
<h2>Where can I see this stuff...?</h2>
<p>My work is kept in the &quot;<a class="reference external" href="https://hg.instantbird.org/experiments/file/IRC-JavaScript/">experiments</a>&quot; repository on Instantbird's
<a class="reference external" href="http://mercurial.selenic.com/">Mercurial</a> repository.&nbsp; There's also a variety of bugs open (they're
listed above, I'm not going to re-list them), although not a ton is
happening in them.</p>
</div>
<div class="section" id="how-can-i-help">
<h2>How can I help?!</h2>
<p>Well you can of course feel free to download the code and hack on it,
let me know (via IRC or any of the bugs most likely) if you have a patch
you'd like me to apply.&nbsp; Or if you just found something that doesn't
work you can feel free to let me know, although I probably just haven't
gotten around to fixing it yet.</p>
<p>Also, if you've ever found something annoying / broken in the IRC
implementation in Instantbird / libpurple please let us know (through
any of the above contact sources).</p>
<p>Hopefully that's a bit of a better explanation of why we're spending
time to rewrite the IRC protocol implementation into JavaScript -- we
definitely think it's worth it and can lead to a bunch of new unique
protocol plug-ins for Instantbird.</p>
</div>

            </div><!-- /.entry-content -->


        </div><!-- /.eleven.columns -->
        
<div class="three columns">

<h4>Pages</h4>

 <ul>
      <li><a href="http://patrick.cloke.us/pages/about.html">About</a></li>
      <li><a href="http://patrick.cloke.us/pages/contact.html">Contact</a></li>
  </ul>

<h4>Categories</h4>
<ul>
		<li><a href="http://patrick.cloke.us/category/mozilla.html">Mozilla</a></li>
</ul>


<h4><i class="icon-tag"></i>Tags</h4>
	<ul>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/email.html">email</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/irc.html">IRC</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/programming.html">programming</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/messaging.html">messaging</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/google.html">Google</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/mozilla.html">Mozilla</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/customizing.html">customizing</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/smtp.html">SMTP</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/bugs.html">bugs</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/sipe.html">SIPE</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/pop3.html">POP3</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/status.html">status</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/im.html">IM</a></li>
	    <li class="tag-1"><a href="http://patrick.cloke.us/tag/instantbird.html">Instantbird</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/thunderbird.html">Thunderbird</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/chat.html">chat</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/rss.html">RSS</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/lightning.html">Lightning</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/specifications.html">specifications</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/imap.html">IMAP</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/gsoc.html">GSoC</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/crosspost.html">crosspost</a></li>
	    <li class="tag-3"><a href="http://patrick.cloke.us/tag/wat.html">Wat</a></li>
	    <li class="tag-4"><a href="http://patrick.cloke.us/tag/oscar.html">OSCAR</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/instant-messaging.html">instant messaging</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/yahoo.html">Yahoo</a></li>
	    <li class="tag-2"><a href="http://patrick.cloke.us/tag/community.html">community</a></li>
</ul>



<h4><i class="icon-rss"></i>Subscribe</h4>
<ul>
  <li><a href="http://patrick.cloke.us/feeds/all.atom.xml">Full Atom Feed</a></li>
  <li><a href="http://patrick.cloke.us/feeds/all.rss.xml">Full RSS Feed</a></li>
</ul>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">

                <li><div class="btn primary"><a href="https://www.github.com/clokep" target="_blank">Github</a></div></li>

                <li><div class="btn bitbucket"><a href="https://bitbucket.org/clokep" target="_blank">BitBucket</a></div></li>

                <li><div class="btn mozillians"><a href="https://mozillians.org/clokep" target="_blank">Mozillians</a></div></li>

                <li><div class="btn twitter"><a href="https://www.twitter.com/clokep" target="_blank">Twitter</a></div></li>



              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="http://patrick.cloke.us/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="http://patrick.cloke.us/theme/js/libs/gumby.min.js"></script>
  <script src="http://patrick.cloke.us/theme/js/plugins.js"></script>
</body>
</html>