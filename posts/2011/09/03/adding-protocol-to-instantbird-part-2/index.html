<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Feed configuration. -->
    <link href="https://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Patrick Cloke Atom Feed" />
    <link href="https://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Patrick Cloke RSS Feed" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="/theme/css/styles.css">
    <link rel="stylesheet" href="/theme/css/borland.css">
    <link rel="stylesheet" href="/theme/css/youtube.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <title>Adding a protocol to Instantbird (Part 2)</title>

    <script>var clicky_site_ids = [101275378];</script>
    <script async src="/theme/js/clicky.js"></script>

    <script async defer data-domain="cloke.us" src="https://plausible.io/js/plausible.js"></script>
  </head>

  <body class="pb-5">
    <nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light border-bottom border-info">
      <a class="navbar-brand" href="/">
        Patrick Cloke
      </a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-items" aria-controls="navbar-items" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbar-items">
        <ul class="navbar-nav ml-auto">

          <li class="nav-item">
            <a class="nav-link" href="/pages/about.html">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/pages/projects.html">Projects</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="/archives.html">Archives</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/tags.html">Tags</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="social-dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Social
            </a>

            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="social-dropdown">
              <a class="dropdown-item" href="https://www.twitter.com/clokep" target="_blank">
                <span class="fab fa-twitter mr-1"></span> twitter
              </a>
              <a class="dropdown-item" href="https://mastodon.social/@clokep" target="_blank">
                <span class="fab fa-mastodon mr-1"></span> mastodon
              </a>
              <a class="dropdown-item" href="https://www.github.com/clokep" target="_blank">
                <span class="fab fa-github mr-1"></span> github
              </a>
              <a class="dropdown-item" href="https://gitlab.com/clokep" target="_blank">
                <span class="fab fa-gitlab mr-1"></span> gitlab
              </a>
              <a class="dropdown-item" href="https://bitbucket.org/clokep" target="_blank">
                <span class="fab fa-bitbucket mr-1"></span> bitbucket
              </a>
              <a class="dropdown-item" href="https://mozillians.org/u/clokep/" target="_blank">
                <span class="fab fa-firefox mr-1"></span> mozillians
              </a>
            </div>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="feeds-dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Feeds
            </a>

            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="feeds-dropdown">
              <a class="dropdown-item" href="https://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a>
              <a class="dropdown-item" href="https://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate">rss feed</a>
            </div>
          </li>

          <form class="form-inline" method="get" action="http://www.google.com/search">
            <input class="form-control form-control-sm mr-sm-2" type="search" name="q" placeholder="Search" aria-label="Search" />
            <input type="hidden"  name="sitesearch" value="patrick.cloke.us" />

            <button class="btn btn-sm btn-outline-info d-none d-sm-inline" type="submit">Search</button>
          </form>
        </ul>
      </div>
    </nav>

<div class="container">
  <div class="row">
    <div class="col-md-12 mt-2 mb-2">
      <h1>
        <a href="/posts/2011/09/03/adding-protocol-to-instantbird-part-2/" rel="bookmark"
           title="Permalink to Adding a protocol to Instantbird (Part 2)">Adding a protocol to Instantbird (Part&nbsp;2)</a>
      </h1>

      <div class="float-right">
        <a href="https://twitter.com/intent/tweet?text=Adding%20a%20protocol%20to%20Instantbird%20%28Part%C2%A02%29&url=https%3A//patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/&hashtags=instantbird,programming,sipe" target="_blank" class="ml-1 mr-1" title="Share on Twitter">
          <span class="fab fa-twitter"></span>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/" target="_blank" class="ml-1 mr-1" title="Share on Facebook">
          <span class="fab fa-facebook"></span>
        </a>
        <a href="mailto:?subject=Adding%20a%20protocol%20to%20Instantbird%20%28Part%C2%A02%29&amp;body=https%3A//patrick.cloke.us/posts/2011/09/03/adding-protocol-to-instantbird-part-2/" target="_blank" class="ml-1 mr-1" title="Share via Email">
          <span class="fas fa-envelope"></span>
        </a>
      </div>

      <i>Saturday, September 3, 2011</i>

      <br>
      <i>
        Tags:           <a href="/tag/instantbird.html">Instantbird</a>,          <a href="/tag/programming.html">programming</a>,          <a href="/tag/sipe.html">SIPE</a>      </i>

      <div class="mt-3">
        <div class="border border-info rounded float-left p-2 mr-2 mb-1">
          <b>Table of Contents</b>
          <div class="toc" id="">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#purple" id="id1">Purple</a></li>
<li><a class="reference internal" href="#core" id="id2">Core</a></li>
<li><a class="reference internal" href="#api" id="id3"><span class="caps">API</span></a></li>
<li><a class="reference internal" href="#sametime-support" id="id4">Sametime support</a></li>
</ul>
</div>
        </div>

        
<p>I had <a class="reference external" href="https://patrick.cloke.us/posts/2011/06/18/adding-new-protocol-sipeoffice/">previously talked about adding a protocol to Instantbird</a>,
that focused on adding <span class="caps">SIPE</span> (Microsoft Office Communicator support).
Since then I’ve been slowly working on defeating <span class="caps">SIPE</span>. Fortunately I
found a few flags that help us compile it easily in Instantbird: we can
declare that we do <em>not</em> have gmime and the standard libpurple <span class="caps">MIME</span>
functions will be used (they might not be as good, but it keeps from
adding &gt;10 <span class="caps">MB</span> of source to Instantbird).</p>
<p>Some modifications to the <span class="caps">SIPE</span> source were made to compile it in
Instantbird (note that most of the changes were probably more based on
using <span class="caps">MSVC</span>, than having to do with Instantbird). The code is also
broken up into a few different sections the core, api, and purple are
ones we care about (they’re working on making a general Office
Communicator protocol library, so the purple folder contains the
libpurple bindings that use the api, while the core is private).</p>
<div class="section" id="purple">
<h2><a class="toc-backref" href="#id1">Purple</a></h2>
<p>Changes to purple consisted mostly of ifdefs that remove some header
files not supported on Windows. For example, I encountered a few of:</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
</pre></div>
<p>Luckily there was already a define <tt class="docutils literal">HAVE_UNISTD_H</tt>, so I just needed
to add:</p>
<div class="highlight"><pre><span></span><span class="cp">#ifdef HAVE_UNISTD_H</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>
</pre></div>
<p>Easy! There were also a couple other issues, but those were rather trivial.</p>
</div>
<div class="section" id="core">
<h2><a class="toc-backref" href="#id2">Core</a></h2>
<p>There isn’t a specific issue in the core I’d like to highlight, it did
use a few glib functions which we didn’t have (we removed the files, as
they were unused), they were all reimplemented in libpurple though, so
we were able to just define the function calls to the libpurple variants.</p>
</div>
<div class="section" id="api">
<h2><a class="toc-backref" href="#id3"><span class="caps">API</span></a></h2>
<p>This had similar issues the core (in particular, there was a function
which used <tt class="docutils literal">g_usleep</tt>, which is blocking and a definite no-no for a
protocol plug-in, I’ve removed that…hopefully it doesn’t break
anything!) In addition to that, we needed to use the libpurple l10n
system instead of glib’s gi18n.h, this was easily copied from
libpurple’s internal <span class="caps">API</span> though.</p>
<p>So at this point…I have a copy of <span class="caps">SIPE</span> compiled! Unfortunately
since I’m using Visual Studio Express I cannot compile on my computer
and deploy to other computers for testing (a Mozilla issue with how it
uses some of the header files, etc., I believe). I’m looking into
trying to get this to work though, apparently using the exact same copy
of <span class="caps">MSVC</span> Redistributable might help. Once this is tested, hopefully
it’ll land in Instantbird for use!</p>
</div>
<div class="section" id="sametime-support">
<h2><a class="toc-backref" href="#id4">Sametime support</a></h2>
<p>Unrelated to <span class="caps">SIPE</span>, but recently I landed a patch in Instantbird to add
back Sametime support (Sametime is Lotus Notes’ equivalent to Office
Communicator). You can see the gory details in <a class="reference external" href="https://bugzilla.instantbird.org/show_bug.cgi?id=102">bug 102</a>, but in
general it’s similar to what I’ve (not gone into great detail about)
here. Most of getting Sametime to work was rewriting some C code
that doesn’t compile in <span class="caps">MSVC</span>. There’s also a <a class="reference external" href="https://bugzilla.instantbird.org/attachment.cgi?id=797&amp;action=diff">diff</a> of all the
changes I made to the libpurple Sametime plugin and the external library
(called <a class="reference external" href="http://meanwhile.sourceforge.net/">Meanwhile</a>) to get it to work. Once I get Monotone (a version
control system) set up I’ll look into getting these changes pushed back
to libpurple to avoid diverging code bases.</p>
</div>

      </div>

<div id="disqus_thread"></div>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = '/posts/2011/09/03/adding-protocol-to-instantbird-part-2/';
this.page.identifier = 'adding-protocol-to-instantbird-part-2';
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://clokep.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</div>

    <nav class="navbar fixed-bottom navbar-light bg-light border-top border-info">
      <a href="https://getpelican.com/" class="nav-item" target="_blank">Powered by Pelican</a>
      <a href="https://github.com/clokep/clokep.github.io" class="nav-item" target="_blank">
        Source available on GitHub <span class="fab fa-github"></span>
      </a>
    </nav>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

  </body>
</html>